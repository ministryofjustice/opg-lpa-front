{# Form Validation - Error Summary #}
{% macro formErrorSummary(error, form, message) %}

    {% if (error is not empty or form.getMessages|length > 0) %}
    <div class="error-summary text" role="group" aria-labelledby="error-heading" tabindex="-1">
        <h1 class="heading-medium error-summary-heading" id="error-heading">{{ message }}</h1>

        {# Show this only if it's a form error #}
        {% if form.getMessages|length > 0 %}
            <p>You need to do the following:</p>
        {% endif %}

        {% if error is not empty %}
            {# API errors #}
            <div class="error-summary-text" data-tracking-context="API error">
                {% if error == 'user-not-found' %}
                    <p data-tracking-summary="User not found">
                        We could not find an LPA account for this email address.<br><a href="signup">Create an LPA account now.</a>
                    </p>
                {% elseif error == 'address-already-registered' %}
                    <p data-tracking-summary="Email address already registered">
                        This email address has already been registered. Please <a href="{{ url('login') }}">sign in</a> or <a href="{{ url('forgot-password') }}">reset your password</a>.
                    </p>
                {% elseif error == 'user-already-has-email' %}
                    <p data-tracking-summary="User already has email address">
                        You're already using that email address for this account – please enter another email address.
                    </p>
                {% elseif error == 'email-already-exists' %}
                    <p data-tracking-summary="Email address already exists">
                        Another LPA account is already using that email address – please enter a different email address.
                    </p>
                {% else %}
                    <p data-tracking-summary="{{ error }}">
                        {{ error }}
                    </p>
                {% endif %}
            </div>
        {% else %}
            <ul class="error-summary-list">
                {# Form errors #}
                {{ formLinkedErrorListV2(form) ? '' }}
            </ul>
        {% endif %}
    </div>
    {% endif %}

{% endmacro %}

{# Text input #}
{% macro formGroup(element) %}

<div class="form-group{{ element.getMessages|length >0 ? ' error'}}">
    <label class="form-label" for="{{ element.getAttribute('id') }}">
        {{ element.getOption('label') }}
        {{ formElementErrorsV2(element) }}
    </label>
    {{ formElement(element) }}
</div>

{% endmacro %}

{# Checkbox #}
{% macro formGroupCheckbox(element) %}

<div class="option group">
    <label class="form-label" for="{{ element.getAttribute('id') }}">
        {{ element.getOption('label')|raw }}
    </label>
    {{ formElement(element) }}
</div>

{% endmacro %}

{% macro displayUseMyDetailsLink() %}
    {% set currentHostLength = serverUrl() | length %}
    {% set action = serverUrl(true)[currentHostLength:] %}
    <div class="action-item use-details-link-panel hard--bottom">
        <form novalidate="novalidate" method="post" action="{{ action }}">
            <input type="hidden" name="reuse-details" value="0">
            <input type="submit" name="submit" class="button-input-to-link" value="Use my details">
        </form>
    </div>
{% endmacro %}

{% macro addSwitchAttorneyTypeLink(switchAttorneyTypeRoute, lpa, trustLink) %}
    {% if (switchAttorneyTypeRoute) %}
        <div class="action-item use-details-link-panel hard--bottom">
            <a class="js-form-popup" href="{{ url(switchAttorneyTypeRoute, {'lpa-id': lpa.id}) }}">Using {{ trustLink ? 'a trust corporation' : 'an individual' }}?</a>
        </div>
    {% endif %}
{% endmacro %}

{% macro renderFormButtons(cancelUrl, backButtonUrl) %}
    {# Submit button #}
    <input type="submit" name="submit" id="form-save" value="Save details" class="button">

    {# Back button - if necessary #}
    {% if (backButtonUrl) %}
        <a href="{{ backButtonUrl }}" class="button button-secondary js-form-popup">Back</a>
    {% endif %}

    {# Cancel button #}
    {% if cancelUrl %}
        <a href="{{ cancelUrl }}" class="button button-secondary js-cancel">Cancel</a>
    {% endif %}
{% endmacro %}

