{% extends 'layout/twig/layout.twig' %}

{% import "application/dashboard/macros.twig" as macros %}

{% block pageTitle %}
    Your LPAs
{% endblock %}

{% block content %}

{% if message %}

    <h3>{{ message }}</h3>

{% else %}

<div class="grid-row">
    <div class="column-two-thirds">
        <div class="text">
            <p class="lede">On this page you'll find all the LPAs that you've created. As well as creating a new LPA from scratch, you can:</p>
            <ul class="list list-bullet">
                <li><strong class="bold-small">Continue creating</strong> an LPA</li>
                <li>Check that the <strong class="bold-small">signing dates</strong> on an LPA are in the right order before you
                    register it. (If they're not in the right order, you risk having to repay some or all of the
                    application fee.)
                </li>
                <li><strong class="bold-small">Reuse details</strong> from an existing LPA to create a new one and save you
                    entering some information twice
                </li>
            </ul>    
        </div>
    </div>
    <div class="column-one-third">
        <div class="panel-cta tablet-and-up">
            <p class="heading-medium panel-body flush--top">Create another LPA</p>
            <p class="panel-button flush--bottom">
                <a class="button" href='{{ url('user/dashboard/create-lpa') }}' role="button">Start now</a>
            </p> 
        </div>
    </div>
</div>

{% endif %}

{% set shortList = lpas.getTotalItemCount() <= 20 and isSearch == false %}

{% if shortList %}
{# With less than 20 LPAs, no search is displayed #}
    {% if lpas.getTotalItemCount() == 0 %}
        <h2 class="heading-large flush--ends">You have no LPAs</h2>
    {% endif %}
{% else %}
{# Over 20 LPAs and search is presented #}
<div class="dashboard-search">
    <div class="grid-row">
        <div class="column-one-half">
            {% if lpas.getTotalItemCount() == 0 %}
            {# No LPAs to display #}
                <h2 class="heading-large flush--ends">No LPAs found</h2>
                {% if isSearch %}
                    <p class="flush--bottom">
                        Your search has found no results.<br>
                        <a id="clear" href='{{ url('user/dashboard') }}'>Clear search results</a>
                    </p>
                {% endif %}
            {% else %}
            {# LPAs to display #}
                {% if isSearch %}
                {# from a search #}
                    <h2 class="heading-large flush--ends">Search: {{ freeText ? escapeHtmlAttr( freeText ) : '' }}</h2>
                    <p class="flush--bottom">
                        Your search has found {{ lpas.getTotalItemCount() }} results.<br>
                        <a id="clear" href='{{ url('user/dashboard') }}'>Clear search results</a>
                    </p>
                {% else %}
                {# total LPAs #}
                    <h2 class="heading-large flush--ends">All {{ lpas.getTotalItemCount() }} LPAs</h2>
                {% endif %}
            {% endif %}
        </div>
        <div class="column-one-half">
            <form action="{{ url('user/dashboard') }}" method="GET" class="search-form">
                <fieldset>
                    <legend class="visuallyhidden">Search for LPAs</legend>
                    <label for="search" class="search-label">Search for an LPA or donor</label>
                    <input type="text" id="search" name="search" value="{{ freeText ? escapeHtmlAttr( freeText ) : '' }}" class="js-search-focus search-input form-control"/>
                    <input class="search-button button" type="submit" value="Search"/>
                </fieldset>
            </form>
        </div>
        <div class="column-one-half">
        {# This is only displayed on mobile #}
            {% if lpas.getTotalItemCount() == 0 %}
            {# No LPAs to display #}
                <h2 class="heading-large flush--ends">No LPAs found</h2>
                {% if isSearch %}
                    <p class="flush--bottom">
                        Your search has found no results.<br>
                        <a id="clear" href='{{ url('user/dashboard') }}'>Clear search results</a>
                    </p>
                {% endif %}
            {% else %}
            {# LPAs to display #}
                {% if isSearch %}
                {# from a search #}
                    <h2 class="heading-large flush--ends">Search: {{ freeText ? escapeHtmlAttr( freeText ) : '' }}</h2>
                    <p class="flush--bottom">
                        Your search has found {{ lpas.getTotalItemCount() }} results.<br>
                        <a id="clear" href='{{ url('user/dashboard') }}'>Clear search results</a>
                    </p>
                {% else %}
                {# total LPAs #}

                    <h2 class="heading-large flush--ends">All {{ lpas.getTotalItemCount() }} LPAs</h2>
                {% endif %}
            {% endif %}
        </div>
    </div>
</div>
{% endif %}

{% if lpas.getTotalItemCount() > 0 %}

    {% if shortList %}
    	{{ macros.listLpas(lpas, true, '', 'No type selected') }}
        {{ macros.listLpas(lpas, true, 'property-and-financial', 'Property and finance') }}
        {{ macros.listLpas(lpas, true, 'health-and-welfare', 'Health and welfare') }}
    {% else %}
    	{{ macros.listLpas(lpas, false, 'all', '') }}
    {% endif %}

    <? /* Pagination HTML is in pagination.phtml */ ?>
    {{ paginationControl(lpas, 'Sliding', 'application/dashboard/pagination', {'route': 'user/dashboard/pagination'}) }}

    <p>
{% endif %}

<div class="panel-cta mobile">
    <p class="heading-medium panel-body flush--top">Create another LPA</p>
    <p class="panel-button flush--bottom">
        <a class="button" href='{{ url('user/dashboard/create-lpa') }}' role="button">Start now</a>
    </p> 
</div>
  
{% endblock %}