{% extends 'layout/twig/layout.twig' %}

{% import "application/dashboard/macros.twig" as macros %}

{% block pageTitle %}
    Your LPAs
{% endblock %}

{% block content %}

{% if message %}

    <h3>{{ message }}</h3>

{% else %}

<div class="grid-row">
    <div class="column-two-thirds">
        <div class="text">
            <p class="lede">On this page you'll find all the LPAs that you've created. As well as creating a new LPA from scratch, you can:</p>
            <ul class="list list-bullet">
                <li><strong class="bold-small">Continue creating</strong> an LPA</li>
                <li>Check that the <strong class="bold-small">signing dates</strong> on an LPA are in the right order before you
                    register it. (If they're not in the right order, you risk having to repay some or all of the
                    application fee.)
                </li>
                <li><strong class="bold-small">Reuse details</strong> from an existing LPA to create a new one and save you
                    entering some information twice
                </li>
            </ul>    
        </div>
    </div>
    <div class="column-one-third">
        <div class="panel-cta">
            <p class="heading-medium panel-body flush--top">Create another LPA</p>
            <p class="panel-button flush--bottom">
                <a class="button" href='{{ url('user/dashboard/create-lpa') }}' role="button">Start now</a>
            </p>
            
        </div>
    </div>
</div>

{% endif %}

<hr>
{% set shortList = lpas.getTotalItemCount() <= 9 and isSearch == false %}

{% if lpas.getTotalItemCount() == 0 %}
    {% if shortList %}
        <h2 class="heading-large">You have no LPAs</h2>
    {% else %}
        <div class="grid-row">
            <div class="column-one-half">
                <h2 class="heading-large">No LPAs found</h2>
                {% if isSearch %}
                    <p>
                        Your search has found no results.<br>
                        <a id="clear" href='{{ url('user/dashboard') }}'>Clear search results</a>
                    </p>
                {% endif %}
            </div>
            <div class="column-one-half">
                <form action="{{ url('user/dashboard') }}" method="GET" class="lpa-search-form">
                    <fieldset>
                        <legend class="visuallyhidden">Search for LPAs</legend>
                        <div class="">
                            <label for="search" class="form-label">
                                <span class="form-label-bold">Search LPAs</span>
                            </label>
                            <span class="form-hint">LPA number, donor's first or last name</span>
                            <input type="text" id="search" name="search" value="{{ freeText ? escapeHtmlAttr( freeText ) : '' }}" class="form-control"/>
                            <input class="add button" type="submit" value="Search"/>
                        </div>
                    </fieldset>
                </form>
            </div>
        </div>
    {% endif %}
{% endif %}

{% if lpas.getTotalItemCount() > 0 %}

{% if not shortList %}
    <div class="grid-row">
        <div class="column-one-half">
            <h2 class="heading-large">All {{ lpas.getTotalItemCount() }} LPAs</h2>
            {% if isSearch %}

                {% if lpas.getTotalItemCount() == 0 %}

                    <p>
                        Your search has found no results.<br>
                        <a id="clear" href='{{ url('user/dashboard') }}'>Clear search results</a>
                    </p>

                {% else %}

                    <p>
                        Your search has found {{ lpas.getTotalItemCount() }} results.<br>
                        <a id="clear" href='{{ url('user/dashboard') }}'>Clear search results</a>
                    </p>

                {% endif %}

            {% endif %}
        </div>
        <div class="column-one-half">
            <form action="{{ url('user/dashboard') }}" method="GET" class="lpa-search-form">
                <fieldset>
                    <legend class="visuallyhidden">Search for LPAs</legend>
                    <div class="">
                        <label for="search" class="form-label">
                            <span class="form-label-bold">Search LPAs</span>
                        </label>
                        <span class="form-hint">LPA number, donor's first or last name</span>
                        <input type="text" id="search" name="search" value="{{ freeText ? escapeHtmlAttr( freeText ) : '' }}" class="form-control"/>
                        <input class="add button" type="submit" value="Search"/>
                    </div>
                </fieldset>
            </form>
        </div>
    </div>
{% endif %}
<hr>

{% if shortList %}
	{{ macros.listLpas(lpas, true, '', 'Unstarted') }}
	{{ macros.listLpas(lpas, true, 'property-and-financial', 'Property and Finance') }}
	{{ macros.listLpas(lpas, true, 'health-and-welfare', 'Health and Welfare') }}
{% else %}
	{{ macros.listLpas(lpas, false, 'all', '') }}
{% endif %}

<? /* Pagination HTML is in pagination.phtml */ ?>
{{ paginationControl(lpas, 'Sliding', 'application/dashboard/pagination', {'route': 'user/dashboard/pagination'}) }}

<p>
{% endif %}
  
{% endblock %}