{% extends 'layout/twig/layout.twig' %}

{% block content %}

{% if message %}

    <h3>{{ message }}</h3>

{% else %}

    <div class="dashboard-header indent-2em">

        {% if lpas.getTotalItemCount() == 0 %}

            {% if isSearch %}
                <p>Your search has found no results</p>
            {% else %}
                <p>You haven't created any LPAs yet.</p>
            {% endif %}

        {% else %}

            {% if isSearch %}
                <p>Your search has found these results</p>
            {% else %}
                {% if hasV1Lpas %}
                    <p style="background-color: #ffbf47; padding: 10px;">
                        Please note: records of LPAs made using this service before 1 July 2015 will be deleted from your account on 1 January 2016. If you want to use an LPA made before 1 July 2015, you'll need to print and sign it before 1 January 2016.
                    </p>
                {% endif %}

                <p>On this page you'll find all the LPAs that you've created. As well as creating a new LPA from
                    scratch, you can:</p>
                <div>
                    <ul>
                        <li><strong>Continue creating</strong> an LPA</li>
                        <li>Check that the <strong>signing dates</strong> on an LPA are in the right order before you
                            register it. (If they're not in the right order, you risk having to repay some or all of the
                            application fee.)
                        </li>
                        <li><strong>Reuse details</strong> from an existing LPA to create a new one and save you
                            entering some information twice
                        </li>
                    </ul>
                </div>
           	{% endif %}

        {% endif %}

    </div>

{% endif %}

<div class="toolbar toolbar__dashboard">

    {% if user.lastLogin %}
        <p style="text-align: right;">You were last signed in on {{ user.lastLogin.format('j F Y \a\t g:ia') }}</p>
    {% endif %}

    <div class="tool tool__search">
        <form action="{{ url('user/dashboard') }}" method="GET">
            <input type="text" name="search"
                   placeholder="LPA no, donor's first or last name"
                   value="{{ freeText ? escapeHtmlAttr( freeText ) : '' }}"/>
            <a class="button" id="clear" href='{{ url('user/dashboard') }}' role="button">Clear</a>
            <input class="add button" type="submit" value="Search"/>
        </form>
    </div>
    <div class="tool tool__create">
        <a class="add button" href='{{ url('user/dashboard/create-lpa') }}' role="button">Create a new LPA</a>
    </div>

</div>

{% if lpas.getTotalItemCount() > 0 %}

<table id="savedforms" class="lpa-list">
    <thead>
    <tr>
        <th>LPA number</th>
        <th>Donor</th>
        <th>Type</th>
        <th>Progress</th>
        <th>Last saved on</th>
        <th>&nbsp;</th>
    </tr>
    </thead>
    <tbody>
    {% for key,lpa in lpas %}
            <tr>
                <td>{{ formatLpaId(lpa.id) }}</td>
                <td>{{ lpa.donor }}</td>
                <td>{{ lpa.type == 'property-and-financial' ? 'PF' : ((lpa.type == 'health-and-welfare') ? 'HW' : '') }}</td>
                <td>{{ lpa.progress }}</td>
                <td>{{ lpa.updatedAt.format('d/m/y') }}</td>
                <td>
                    <div class="lpa-actions">
                        <a class="button"
                           href="/lpa/{{ lpa.id }}">{{ lpa.progress == 'Completed' ? 'View LPA' : 'Continue' }}</a>

                        {% if (lpa.progress == 'Completed' or lpa.progress == 'Created') %}
                            <a class="button-secondary" href="/lpa/{{ lpa.id }}/date-check">Check dates</a>
                        {% endif %}

                        {% if lpa.progress != 'Started' %}
                            <a class="button-secondary"
                               href="{{ url('user/dashboard/create-lpa', {'lpa-id': lpa.id}) }}">Reuse
                                details</a>
                        {% endif %}

                        <a class="button-warning delete-lpa"
                           href="/user/dashboard/delete-lpa/{{ lpa.id }}">Delete</a>
                    </div>
                </td>
            </tr>
    {% endfor %}

    </tbody>
</table>

<? /* Pagination HTML is in pagination.phtml */ ?>
{{ paginationControl(lpas, 'Sliding', 'application/dashboard/pagination', {'route': 'user/dashboard/pagination'}) }}

<p>
{% endif %}
  
{% endblock %}