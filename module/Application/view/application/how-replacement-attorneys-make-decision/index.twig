{% extends 'layout/twig/accordion-layout.twig' %}

{% block content %}

{% import "application/macros.twig" as macros %}

{# Error messages #}
{% set form = formErrorTextExchange(form, {
    'how' : {
        'Value is required and can\'t be empty' : 'Please choose how your replacement attorneys make decisions',
    },
    'howDetails': {
    	'Value is required and can\'t be empty' : 'Please tell us which decisions have to be made jointly, and which can be made jointly and severally'
	}
}) %}

{# Set form fields variables #}
{% set how = form.get('how') %}
{% set howDetails = form.get('howDetails') %}
{% set currentHowValueOptions = how.getOptions()['value_options'] %}

{{ howDetails.setAttributes({
    id: 'howDetails',
    rows: 10,
    cols: 67,
    maxlength: 2000,
    class: 'form-control'
}) ? ''}}

{% set howValueOptions = {
	'jointly-attorney-severally' :{
		attributes: {
			id: 'how-jointly-attorney-severally'
		},
		label: '<strong class="bold-small">Jointly and severally</strong><span class="text form-hint form-hint--strong">Replacement attorneys can make decisions on their own or together. Most people choose this option because it’s the most practical.</span>',
		label_attributes: {
			for: 'how-jointly-attorney-severally'
		},
		value: currentHowValueOptions['jointly-attorney-severally'].value
	},
	'jointly' : {
		attributes: {
			id: 'how-jointly'
		},
		label: '<strong class="bold-small">Jointly</strong><span class="text form-hint form-hint--strong">Replacement attorneys must agree unanimously on every decision, however big or small. If one of your attorneys can no longer act the others will no longer be able to act, unless you state otherwise in the \'Instructions\' section later.</span>',
		label_attributes: {
			for: 'how-jointly'
		},
		value: currentHowValueOptions['jointly'].value
	},
	'depends' : {
		attributes: {
			id: 'how-depends'
		},
		label: '<strong class="text bold-small">Jointly for some decisions, and jointly and severally
			for other decisions</strong><span class="text form-hint form-hint--strong">
			Replacement attorneys must agree unanimously on some decisions, but can make others on their own. You’ll need to state which decisions need to be agreed unanimously.</span>',
		label_attributes: {
			for: 'how-depends',
			'data-target': 'decisions-details'
		},
		value: currentHowValueOptions['depends'].value
	}
}%}

{{ how.setOptions({
	value_options: howValueOptions,
	label_attributes: {'class': 'text block-label'}
}) ? '' }}

{{ how.setLabelOptions({
	disable_html_escape: true
}) ? '' }}

{# form fields labels #}
{{ howDetails.setOptions({label:'Details'}) ? '' }}

<li id="replacement-attorney-decision-sections" class="section current">

	<h2 class="heading-medium accordion-header flush--top">How should your replacement attorneys make decisions?</h2>

    <div class="accordion-info">
		<div class="text">
			<p>Most people want their replacement attorneys to work together in the same way that their original attorneys did.</p>
    		<p>But if you want, you can choose to appoint your replacement attorneys differently to your originals.</p>
			<p><a class="js-guidance" href="/guide#topic-how-multiple-attorneys-make-decisions" data-journey-click="stageprompt.lpa:help:how-multiple-attorneys-make-decisions">Get help with making this decision</a></p>
		</div>
	</div>

	{# begin form #}
  {{ form.prepare() ? '' }}
  {{ form().openTag( form )|raw }}
  {{ formElement(form.getCsrf) }}

	{{ macros.formErrorSummary(error,form,'There was a problem submitting the form') }}

	<fieldset id="how">
        <legend class="visuallyhidden">How should the replacement attorneys make decisions?</legend>
            <h2 class="heading-medium flush--top">How should the replacement attorneys make decisions?</h2>

            <div class="form-group {{ how.getMessages|length > 0 ? 'error'}}">
                {{ formElementErrorsV2(how) }}
                {{ formElement(how) }}
                <div id="decisions-details" class="panel panel-border-narrow js-hidden">
                    <p class="text">
                        Please tell us which decisions have to be made jointly, and which can be made jointly and severally. These decisions will be printed on a extra sheet the donor will need to sign and date.
                        <a class="js-guidance" href="/guide#topic-how-multiple-attorneys-make-decisions" data-journey-click="stageprompt.lpa:help:how-multiple-attorneys-make-decisions">Take a look at the guidance</a> for examples of how to make your wishes clear.
                    </p>
                    {{ macros.formGroup(howDetails) }}
                </div>
            </div>
    </fieldset>

    <div class="form-group">
        {{ formElement(form.get('save')) }}
    </div>

    {{ form().closeTag|raw }}

</li>

{% endblock %}
