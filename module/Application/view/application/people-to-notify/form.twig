{% extends isPopup ? 'layout/twig/popup.twig' : 'layout/twig/layout.twig' %}

{% block pageTitle %}
    Create a lasting power of attorney
{% endblock %}

{% block content %}

{% import "application/macros.twig" as macros %}

{# Error messages #}
{% set form = formErrorTextExchange(form,  {
    'name-title' : {
        'must-be-less-than-or-equal:5' : 'Title must be five letters or fewer - please abbreviate, if necessary'
    },
    'name-first' : {
        'cannot-be-blank' : 'Please enter first names'
    },
    'name-last' : {
        'cannot-be-blank' : 'Please enter the last name'
    },
    'address-address1' : {
        'cannot-be-blank' : 'Please enter the first line of address'
    },
    'address-address2' : {
        'linked-1-cannot-be-null' : 'Please enter the second line of address'
    },
    'address-postcode' : {
        'linked-1-cannot-be-null' : 'Please enter the postcode',
        'must-be-less-than-or-equal:8' : 'This is an invalid postcode. If it\'s an overseas postcode, please include it in the address lines rather than in the postcode field.'
    }
}) %}

{# Set form fields variables #}
{% set title = form.get('name-title') %}
{% set firstname = form.get('name-first') %}
{% set lastname = form.get('name-last') %}
{% set address1 = form.get('address-address1') %}
{% set address2 = form.get('address-address2') %}
{% set address3 = form.get('address-address3') %}
{% set postcode = form.get('address-postcode') %}

{# form fields config #}
{{ form.setAttributes({
    'class':'form js-PersonForm js-PostcodeLookup'
}) ? '' }}

{{ title.setAttributes({
    id: 'name-title',
    class: 'form-control'
}) ? '' }}

{{ firstname.setAttributes({
    id: 'name-first',
    class: 'form-control'
}) ? '' }}

{{ lastname.setAttributes({
    id: 'name-last',
    class: 'form-control'
}) ? '' }}

{{ address1.setAttributes({
    id: 'address-address1',
    class: 'form-control'
}) ? ''}}

{{ address2.setAttributes({
    id: 'address-address2',
    class: 'form-control'
}) ? ''}}

{{ address3.setAttributes({
    id: 'address-address3',
    class: 'form-control'
}) ? ''}}

{{ postcode.setAttributes({
    id: 'address-postcode',
    class: 'form-control'
}) ? ''}}

{# form fields labels #}
{{ title.setOptions({label:'Title'}) ? '' }}
{{ firstname.setOptions({label:'First names'}) ? '' }}
{{ lastname.setOptions({label:'Last name'}) ? '' }}
{{ address1.setOptions({label:'Address line 1'}) ? '' }}
{{ address2.setOptions({label:'Address line 2'}) ? '' }}
{{ address3.setOptions({label:'Address line 3'}) ? '' }}
{{ postcode.setOptions({label:'Postcode'}) ? '' }}

<header class="popup-header">
    <i class="icon icon-person"></i>
    <h2 class="heading-small popup-header-title">Person to notify details</h2>
</header>

{{ form.prepare() ? '' }}

{################# person to notify form #####################}

{# Error summary #}
{{ macros.formErrorSummary(error, form, 'There was a problem submitting the form') }}

{# Add reuse details options #}
{% if (reuseDetailsForm and reuseDetailsForm.reusingPreviousLpaOptions()) %}
    {{ reuseDetailsForm(reuseDetailsForm, cancelUrl) }}
{% else %}
    {% if (reuseDetailsForm and not reuseDetailsForm.reusingPreviousLpaOptions()) %}
        {{ reuseDetailsForm(reuseDetailsForm) }}
    {% endif %}

    {# begin form #}
    {{ form().openTag( form )|raw }}
        {{ formElement(form.get( form.csrfName )) }}
        {{ formElementErrorsV2(form.get( form.csrfName )) }}

        <h2 class="heading-medium">What is the person's name?</h2>

        <fieldset>
            <legend class="visuallyhidden">Add person's name</legend>

            {{ macros.formGroup(title) }}
            {{ macros.formGroup(firstname) }}
            {{ macros.formGroup(lastname) }}

        </fieldset>

        <h2 class="heading-medium">What is the person's address?</h2>

        <fieldset class="postcodelookup">
            <legend class="visuallyhidden">Address</legend>
            <div class="js-PostcodeLookup__postal-add">
                {{ macros.formGroup(address1) }}
                {{ macros.formGroup(address2) }}
                {{ macros.formGroup(address3) }}
                {{ macros.formGroup(postcode) }}
            </div>
        </fieldset>

        {{ macros.renderFormButtons(cancelUrl, allowReuseDetailsBackButton) }}

    {{ form().closeTag|raw }}
{% endif %}

{% endblock %}