{% extends 'layout/twig/registration-stage.twig' %}

{% block content %}

{% import "application/macros.twig" as macros %}

{% set form = formErrorTextExchange(form,  {
    'isRepeatApplication' : {
        "Value is required and can't be empty": 'Please choose Yes or No',
    },
    'repeatCaseNumber': {
        "Value is required and can't be empty": "If you are making a repeat application, you need to enter the case number given to you by the Office of the Public Guardian.",
    }
}) %}

{{ form.setAttribute('class', 'form') ? '' }}
{% set csrf = form.get(form.csrfName) %}

{% set isRepeatApplication = form.get('isRepeatApplication') %}
{% set isRepeatApplicationValueOptions = isRepeatApplication.getOptions()['value_options'] %}

{% set isRepeatApplicationValueOptions = {
			'is-repeat' :
				{ 
				  label: "Yes",
	 			  label_attributes: {
	 			       for: 'is-repeat-application',
	 			  },
	 			  attributes: {
	 			       id: 'is-repeat-application'
	 			  },
	 			  value: isRepeatApplicationValueOptions['is-repeat'].value
	 		    },
			'is-new' :
				{ 
				  label: "No",
	 			  label_attributes: {
	 			       for: 'is-new',
	 			  },
	 			  attributes: {
	 			       id: 'is-new'
	 			  },
	 			  value: isRepeatApplicationValueOptions['is-new'].value
	 		    }	 		    
		}
%}

{{ isRepeatApplication.setOptions({value_options: isRepeatApplicationValueOptions}) ? '' }}
{{ isRepeatApplication.setLabelOptions({disable_html_escape: true}) ? '' }}

{% set repeatCaseNumber = form.get('repeatCaseNumber') %}
{{ repeatCaseNumber.setOptions({label: "Case number"}) ? '' }}

<div class="accordion-actions">
	<p>
        <input type="submit" name="save" value="Save and continue" class="button gotonextpart">
    </p>
</div>
        
{{ form.prepare() ? '' }}

<section id="repeat-application-section" class="section current">

    <h2 class="accordion-header">{{ accordionIdx(lpa) }}. Are you making a repeat application to register your LPA?</h2>

    <div class="accordion-content">

        <div class="section-intro">
            <details>

                <summary
                    data-journey-click="stageprompt.lpa:help.inline:register/fees:applying-for-a-reduction-of-the-fee"
                    role="button" aria-expanded="false">What is a repeat application?
                </summary>

                <div>
                    <p>A repeat application is when a previously submitted LPA can’t be registered and has been sent back to 
                        you. It will contain instructions on how to submit a repeat application within 3 months for a reduced fee.
                        You will need the case number from OPG’s letter saying that you can make a
                        repeat application.</p>
                </div>


            </details>
        </div>


        {{ form().openTag( form )|raw }}

        {{ formElement(csrf) }}
		{{ formElementErrors(csrf) }}

        <div class="emphasised option group">
            {{ formElement(isRepeatApplication) }}
			{{ formElementErrors(isRepeatApplication) }}
        </div>

        <div class="js-case-number emphasised option group">
            {{ formLabel.openTag(repeatCaseNumber) }}
            {{ repeatCaseNumber.getOption('label') }}
            {{ formLabel.closeTag()|raw }}
            {{ formElement(repeatCaseNumber) }}
            <p>Your case number is in the letter that came with your returned LPA application.</p>

            <p>By clicking on the Save and continue button, you confirm that the Office of the Public Guardian has told you
                that you can apply to make a repeat application for £55 within 3 months.</p>

            {{ formElementErrors(repeatCaseNumber) }}
        </div>

        <div class="accordion-actions">
            <p>
                <input type="submit" name="save" value="Save and continue" class="button gotonextpart">
            </p>
        </div>

        {{ form().closeTag|raw }}

    </div>

</section>

{% endblock %}
