<?php
    use Opg\Lpa\DataModel\Lpa\Document\Attorneys\Human;
    
    $form = $this->formErrorTextExchange($this->form, []);
    
    $donorElement = $form->get('sign-date-donor');
    $donorElement->setAttributes(['placeholder' => 'DD/MM/YYYY']);
    
    $certificateProviderElement = $form->get('sign-date-certificate-provider');
    $certificateProviderElement->setAttributes(['placeholder' => 'DD/MM/YYYY']);
    
    $primaryAttorneyElements = [];
    foreach ($this->lpa->document->primaryAttorneys as $idx => $attorney) {
        $primaryAttorneyElements[$idx] = $form->get('sign-date-attorney-' . $idx);
        $primaryAttorneyElements[$idx]->setAttributes(['placeholder' => 'DD/MM/YYYY']);
    }
    
    $replacementAttorneyElements = [];
    foreach ($this->lpa->document->replacementAttorneys as $idx => $attorney) {
        $replacementAttorneyElements[$idx] = $form->get('sign-date-replacement-attorney-' . $idx);
        $replacementAttorneyElements[$idx]->setAttributes(['placeholder' => 'DD/MM/YYYY']);
    }
    
    $csrf       = $form->get($form->csrfName());
    
    $form->setAttributes(['class' => 'form']);
    
    $submit     = $form->get('submit');
    $submit->setAttributes(['class'=>'button', 'id'=>'form-submit', 'value'=>'Check dates']);
    
    $formLabel  = $this->plugin('formLabel');
    $form->prepare();
?>

<section id="signature-dates" class='section current'>
	<h2 class='accordion-header'>When was the LPA signed?</h2>
	<?php if (isset($this->dateError)): ?>
    	<?php if ($this->dateError == '') : ?>
    	<div style="border:2px solid green; margin-top:1em; padding:1em; color:#ffffff; font-size:1.5em; background-color:#00bb00">
    	The LPA was signed in the correct order.
    	</div>
    	<?php else: ?>
    	<div style="border:2px solid red; margin-top:1em; padding:1em; color:#ffffff; font-size:1.5em; background-color:#bb0000">
    	There was a problem with the order in which the LPA was signed. 
    	<br>
    	<?= $this->dateError; ?>
    	<br>
    	Please see the <a href="/help/#topic-signing-the-lpa" style="color:#ffffff" class="js-guidance" data-journey-click="stageprompt.lpa:help:signing-the-lpa">guidance</a> on signing and, if necessary,
    	<a href="<?= $this->url( 'lpa/view-docs', [ 'lpa-id'=>$lpa->id ] )?>">reprint</a> and re-sign your LPA.
    	</div>
    	<?php endif; ?>
    <?php endif; ?>
	<div class='accordion-content'>
	
		<div class="section-intro">
<p>This page is optional. It can be used to verify that your LPA has been <a href="/help/#topic-signing-the-lpa" class="js-guidance" data-journey-click="stageprompt.lpa:help:signing-the-lpa">signed in the correct order</a> before sending it to us.</p>
<p>Please give the date each person below signed the LPA.</p>

    </div>


	<?= $this->form()->openTag($form); ?>
    
    <?= $this->formElement($csrf) ?>
    <?= $this->formElementErrors($csrf) ?>
    
    <?= $this->formErrorList(); ?>
    
<div class="person-summary group">
<div class="person">
	<h3><?= $this->lpa->document->donor->name ?> (the donor)</h3>
	<p class="date-field">
		<label for="donor">
			This person signed Section 9 of the LPA on
			
			<?= $this->formElement($donorElement) ?>
            <?= $this->formElementErrors($donorElement) ?>
            
        </label>
	</p>
		<div class="application-notice help-notice">
  		<p class="hint">Remember, if any continuation sheets 1 or 2 were used they must also<br> have been signed by the donor at the same time as or before the donor signed Section 9.</p>
	</div>
</div>
</div>
<div class="person-summary group">
  <div class="person">
      <h3><?= $this->lpa->document->certificateProvider->name ?> (certificate provider)</h3>
      <p class="date-field">
      	<label for="certificateProvider_0">This person signed Section 10 of the LPA on
      	
            <?= $this->formElement($certificateProviderElement) ?>
            <?= $this->formElementErrors($certificateProviderElement) ?>
            
        </label>
      </p>
  </div>
</div>

<?php foreach ($this->lpa->document->primaryAttorneys as $idx => $attorney) : ?>

    <div class="person-summary group">
        <div class="person">
  			<h3><?= $attorney->name ?> (attorney)</h3>
				<p class="date-field">
			<label for="attorney_0">
			     <?php if($attorney instanceof Human): ?> This person signed Section 11 of the LPA on <?php else:?>This corporation signed Continuation Sheet 4 of the LPA on<?php endif;?>
			     <?= $this->formElement($primaryAttorneyElements[$idx]) ?>
                 <?= $this->formElementErrors($primaryAttorneyElements[$idx]) ?>
            </label>
		</p>
	  </div>
</div>

<?php endforeach; ?>

<?php foreach ($this->lpa->document->replacementAttorneys as $idx => $attorney) : ?>

    <div class="person-summary group">
        <div class="person">
  			<h3><?= $attorney->name ?> (replacement attorney)</h3>
				<p class="date-field">
			<label for="attorney_0">
			     <?php if($attorney instanceof Human): ?> This person signed Section 11 of the LPA on <?php else:?>This corporation signed Continuation Sheet 4 of the LPA on<?php endif;?> 
			     <?= $this->formElement($replacementAttorneyElements[$idx]) ?>
                 <?= $this->formElementErrors($replacementAttorneyElements[$idx]) ?>
            </label>
		</p>
	  </div>
</div>

<?php endforeach; ?>

<div class="accordion-actions group">
            <p><?= $this->formElement($submit) ?></p>
        </div>
        
		</div>


    <?= $this->form()->closeTag(); ?>

	</div>
</section>
