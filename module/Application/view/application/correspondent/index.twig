{% extends 'layout/twig/accordion-header.twig' %}

{% block content %}

{% import "application/macros.twig" as macros %}

{% set form = formErrorTextExchange(form, {
    'correspondence' : {
        "at-least-one-option-needs-to-be-selected" : "At least one option must be selected"
    }
}) %}

{% set csrf = form.get(form.csrfName) %}

{% set correspondence = form.get('correspondence') %}

{% set contactByEmail = correspondence.get('contactByEmail') %}
{% set contactByPhone = correspondence.get('contactByPhone') %}
{% set contactByPost  = correspondence.get('contactByPost') %}
{% set contactInWelsh = correspondence.get('contactInWelsh') %}

{{ contactByPost.setOptions({label: 'Post', use_hidden_element: true}) ? '' }}
{{ contactByPost.setAttributes({id: 'contactByPost'}) ? '' }}

{{ contactByPhone.setOptions({
	label: 
		((correspondent['contactPhone']) ? '(' ~ correspondent['contactPhone'] ~ ')' : '<a href="' ~ editRoute ~ '" class="js-form-popup">Add phone number</a>'), 
	use_hidden_element: 
		true}) ? '' }}
{{ contactByPhone.setAttributes({id: 'contactByPhone'}) ? '' }}

{{ contactByEmail.setOptions({
	label: 
		((correspondent['contactEmail']) ? '(' ~ correspondent['contactEmail'] ~ ')' : '<a href="' ~ editRoute ~ '" class="js-form-popup">Add email address</a>'), 
	use_hidden_element: 
		true}) ? '' }}
{{ contactByEmail.setAttributes({id: 'contactByPhone'}) ? '' }}

{{ contactInWelsh.setOptions({label: 'In Welsh', use_hidden_element: true}) ? '' }}
{{ contactInWelsh.setAttributes({id: 'contactInWelsh'}) ? '' }}

{{ form.prepare() ? '' }}

<section id="correspondent-section" class="section current">

	<h2 class="accordion-header">{{ accordionIdx(lpa) }}. Where should we send the LPA and any correspondence?</h2>

    <div class="accordion-content">

		<div class="section-intro">

			<p>We’ll normally write to the applicant if we have any questions and send them the LPA once we’ve registered it.</p>

            <p>However, you might prefer to choose someone else, such as a legal professional, to take care of these things.</p>

            <p>If you want someone who isn't the applicant to receive the LPA and any related correspondence, enter their details below.</p>

            <p><a href="/help/#topic-correspondence-address" class="js-guidance" data-journey-click="stageprompt.lpa:help:correspondence-address">Find out more about the correspondence address</a></p>

		</div>

		<h3>The Correspondent</h3>

		<div class="person-summary group">

		    <div class="person">
				<h3>{{ correspondent['name'] }}</h3>
				<p>{{ correspondent['address'] }}</p>
			</div>

			<ul class="actions">
				<li><a href="{{ editRoute }}" class="js-form-popup">Change this</a></li>
			</ul>
		</div>

        <h3>How would the person above prefer to be contacted?</h3>

        {{ form().openTag( form )|raw }}
        
        {{ formElement(csrf) }}
		{{ formElementErrors(csrf) }}

        {{ formElementErrors(correspondence, 
            {}, 
            {'at-least-one-option-needs-to-be-selected' : 'Please select at least one option'}) 
        }}

        <fieldset style="clear:both;">

            <p>You can choose more than one.</p>

			{{ macros.formGroupCheckbox(contactByPost) }}
			{{ macros.formGroupCheckbox(contactByPhone) }}
			{{ macros.formGroupCheckbox(contactByEmail) }}
			{{ macros.formGroupCheckbox(contactInWelsh) }}


        </fieldset>

        <div class="accordion-actions">
			<p>
                <input type="submit" name="save" value="Save and continue" class="button gotonextpart">
            </p>
        </div>

        {{ form().closeTag|raw }}


    </div>

</section>

{% endblock %}
