{% extends 'layout/twig/accordion-header.twig' %}

{% block content %}

{% import "application/macros.twig" as macros %}

{# Error messages #}
{% set form = formErrorTextExchange(form, {
    'correspondence' : {
        "at-least-one-option-needs-to-be-selected" : "At least one option must be selected"
    }
}) %}

{# Set form fields variables #}
{% set correspondence = form.get('correspondence') %}
{% set contactByEmail = correspondence.get('contactByEmail') %}
{% set contactByPhone = correspondence.get('contactByPhone') %}
{% set contactByPost  = correspondence.get('contactByPost') %}
{% set contactInWelsh = correspondence.get('contactInWelsh') %}

{# form fields config #}
{{ contactByPost.setOptions({
	label_attributes: {'class': 'text block-label'},
	use_hidden_element: true
}) ? '' }}

{{ contactByPost.setAttributes({
	id: 'contactByPost'
}) ? '' }}

{{ contactByPhone.setOptions({ 
	use_hidden_element: true
}) ? '' }}

{{ contactByPhone.setAttributes({
	id: 'contactByPhone'
}) ? '' }}

{{ contactByEmail.setOptions({
	use_hidden_element: true
}) ? '' }}

{{ contactByEmail.setAttributes({
	id: 'contactByEmail'
}) ? '' }}

{{ contactInWelsh.setOptions({
	use_hidden_element: true
}) ? '' }}

{{ contactInWelsh.setAttributes({
	id: 'contactInWelsh'
}) ? '' }}

{# form fields labels #}
{{ contactByPost.setOptions({
	label: 'Post'
}) ? '' }}

{{ contactByPhone.setOptions({
	label: ((correspondent['contactPhone']) ? 'Phone (' ~ correspondent['contactPhone'] ~ ')' : 'Phone')
}) ? '' }}

{{ contactByEmail.setOptions({
	label: ((correspondent['contactEmail']) ? 'Email (' ~ correspondent['contactEmail'] ~ ')' : 'Email')
}) ? '' }}

{{ contactInWelsh.setOptions({
	label: 'In Welsh'
}) ? '' }}

{{ form.prepare() ? '' }}

<li id="correspondent-section" class="section current js-current">

	<h2 class="heading-medium accordion-header flush--top">Where should we send the LPA and any correspondence?</h2>

    <div class="accordion-info">

		<div class="text">

			<p>We’ll normally write to the applicant if we have any questions and send them the LPA once we’ve registered it.</p>

            <p>However, you might prefer to choose someone else, such as a legal professional, to take care of these things.</p>

            <p>If you want someone who isn't the applicant to receive the LPA and any related correspondence, enter their details below.</p>

            <p><a href="/guide#topic-correspondence-address" class="js-guidance" data-journey-click="stageprompt.lpa:help:correspondence-address">Find out more about the correspondence address</a></p>

		</div>
	</div>

	<h3 class="heading-medium flush--top">The Correspondent</h3>

	<div class="person">
        <h3 class="person-name heading-small flush--ends">{{ correspondent['name'] }}</h3>
        <p class="person-address flush--ends">{{ correspondent['address'] }}</p>
        <ul class="person-actions">
            <li class="action-item">
                <a href="{{ editRoute }}" class="action-edit js-form-popup">Change this</a>
            </li>
        </ul>
    </div>

    {# begin form #}
	{{ form.prepare() ? '' }}
	{{ form().openTag( form )|raw }}
	    {{ formElement(form.get( form.csrfName )) }}

	    {{ macros.formErrorSummary(error,form,'There was a problem submitting the form') }}

	    <h3 class="heading-medium flush--top">How would the person above prefer to be contacted?</h3>

        <fieldset>
        	<legend class="visuallyhidden">Contact options</legend>

            <p>You can choose more than one.</p>

            <div class="form-group {{ correspondence.getMessages|length >0 ? 'error'}}">
	            <label class="text block-label" for="{{ contactByPost.getAttribute('id') }}">
	                {{ formElement(contactByPost) }}
	                {{ contactByPost.getOption('label')|raw }}
	            </label>
                {{ formElementErrorsV2(contactByPost) }}

		        <div class="form-group-checkbox {{ contactByPhone.getMessages|length >0 ? 'error'}}">
		            <label class="text block-label" {{ (correspondent['contactPhone']) ? '' : 'data-target="contact-by-phone"' }} for="{{ contactByPhone.getAttribute('id') }}">
		                {{ formElement(contactByPhone) }}
		                {{ contactByPhone.getOption('label')|raw }}
		            </label>
	                <div class="panel panel-border-narrow js-hidden" id="contact-by-phone">
	                	Please <a href="{{ editRoute }}" class="js-form-popup">add phone number</a> to the person's contact details
	                </div>
	                {{ formElementErrorsV2(contactByPhone) }}
		        </div>

		        <div class="form-group-checkbox {{ contactByEmail.getMessages|length >0 ? 'error'}}">
		            <label class="text block-label" {{ (correspondent['contactEmail']) ? '' : 'data-target="contact-by-email"' }} for="{{ contactByEmail.getAttribute('id') }}">
		                {{ formElement(contactByEmail) }}
		                {{ contactByEmail.getOption('label')|raw }}
		            </label>
	                <div class="panel panel-border-narrow js-hidden" id="contact-by-email">
	                	Please <a href="{{ editRoute }}" class="js-form-popup">add email</a> to the person's contact details
	                </div>
	                {{ formElementErrorsV2(contactByEmail) }}
		        </div>

		        <div class="form-group-checkbox {{ contactInWelsh.getMessages|length >0 ? 'error'}}">
		            <label class="text block-label" for="{{ contactInWelsh.getAttribute('id') }}">
		                {{ formElement(contactInWelsh) }}
		                {{ contactInWelsh.getOption('label')|raw }}
		            </label>
	                {{ formElementErrorsV2(contactInWelsh) }}
		        </div>
		        
		        {{ formElementErrorsV2(correspondence) }}

            </div>

        </fieldset>

        <div class="form-group">
            <input type="submit" name="save" value="Save and continue" class="button">
        </div>

	{{ form().closeTag|raw }}

</li>

{% endblock %}
